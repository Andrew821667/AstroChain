
import json
from datetime import datetime

# ะะผะฟะพััะธััะตะผ ะฝะฐัะธ ะผะพะดัะปะธ
exec(open('src/astronomical/data_fetcher.py').read())
exec(open('src/core/blockchain.py').read())
exec(open('src/consensus/proof_of_astronomy.py').read())

class ะัััะพะงะตะนะฝะะตะผะพ:
    """
    ะัััะบะพัะทััะฝะฐั ะดะตะผะพะฝัััะฐัะธั AstroChain
    """
    
    def __init__(self):
        print("๐ ะะฐะฟััะบ ัะธััะตะผั ะัััะพะงะตะนะฝ...")
        
        self.ัะฑะพััะธะบ_ะดะฐะฝะฝัั = AstronomicalDataFetcher()
        self.ะฑะปะพะบัะตะนะฝ = AstroBlockchain()
        self.ะบะพะฝัะตะฝััั = ProofOfAstronomy(block_interval_minutes=1)
        
        print(f"โ ID ัะทะปะฐ: {self.ะบะพะฝัะตะฝััั.node_id}")
        print(f"โ ะะฐัะฐะปัะฝัะน ะฑะปะพะบ ัะพะทะดะฐะฝ")
    
    def ะฟะพะบะฐะทะฐัั_ะฐัััะพะฝะพะผะธัะตัะบะธะต_ะดะฐะฝะฝัะต(self):
        """ะะพะบะฐะทัะฒะฐะตั ัะตะบััะธะต ะฐัััะพะฝะพะผะธัะตัะบะธะต ะดะฐะฝะฝัะต"""
        print("\n๐ === ะะะกะะะงะะกะะะ ะะะะะซะ ===")
        
        ัะฝะธะผะพะบ = self.ัะฑะพััะธะบ_ะดะฐะฝะฝัั.get_astronomical_snapshot()
        
        if "iss" in ัะฝะธะผะพะบ.get("sources", {}):
            ะผะบั = ัะฝะธะผะพะบ["sources"]["iss"]
            print(f"๐ฐ๏ธ ะะะก ะฝะฐัะพะดะธััั:")
            print(f"   ะจะธัะพัะฐ: {ะผะบั['latitude']}ยฐ")
            print(f"   ะะพะปะณะพัะฐ: {ะผะบั['longitude']}ยฐ")
        else:
            print("๐ฐ๏ธ ะะะก: ะดะฐะฝะฝัะต ะฝะตะดะพัััะฟะฝั")
        
        if "solar" in ัะฝะธะผะพะบ.get("sources", {}):
            ัะพะปะฝัะต = ัะฝะธะผะพะบ["sources"]["solar"]
            print(f"โ๏ธ ะกะพะปะฝะตัะฝะฐั ะฐะบัะธะฒะฝะพััั:")
            print(f"   ะะพัะพะบ ัะฐััะธั: {ัะพะปะฝัะต['flux']}")
            print(f"   ะญะฝะตัะณะธั: {ัะพะปะฝัะต['energy']}")
        else:
            print("โ๏ธ ะกะพะปะฝัะต: ะดะฐะฝะฝัะต ะฝะตะดะพัััะฟะฝั")
        
        ะฐัััะพ_ัะตั = self.ัะฑะพััะธะบ_ะดะฐะฝะฝัั.generate_astronomical_hash(ัะฝะธะผะพะบ)
        print(f"๐ ะะพัะผะธัะตัะบะธะน ัะตั: {ะฐัััะพ_ัะตั[:16]}...")
        
        return ัะฝะธะผะพะบ
    
    def ัะพะทะดะฐัั_ััะฐะฝะทะฐะบัะธะธ(self):
        """ะกะพะทะดะฐะตั ัะตััะพะฒัะต ััะฐะฝะทะฐะบัะธะธ"""
        print("\n๐ณ === ะกะะะะะะะ ะขะะะะะะะฆะะ ===")
        
        # ะัััะบะธะต ะฐะดัะตัะฐ ะดะปั ะฝะฐะณะปัะดะฝะพััะธ
        ัั1 = Transaction("ะะปะธัะฐ_ะัััะพะงะตะนะฝ", "ะะพะฑ_ะัััะพะงะตะนะฝ", 1000.0, 
                         {"ะพะฟะธัะฐะฝะธะต": "ะะตัะฒัะน ะฟะตัะตะฒะพะด ะฒ ะัััะพะงะตะนะฝ!"})
        ัั2 = Transaction("ะะพะฑ_ะัััะพะงะตะนะฝ", "ะะปะฐะดะธะผะธั_ะัััะพะงะตะนะฝ", 500.0, 
                         {"ะพะฟะธัะฐะฝะธะต": "ะะพัะผะธัะตัะบะธะน ะฟะตัะตะฒะพะด"})
        ัั3 = Transaction("ะะปะฐะดะธะผะธั_ะัััะพะงะตะนะฝ", "ะะปะธัะฐ_ะัััะพะงะตะนะฝ", 250.0,
                         {"ะพะฟะธัะฐะฝะธะต": "ะะพะทะฒัะฐั ัะฐััะธ ััะผะผั"})
        
        self.ะฑะปะพะบัะตะนะฝ.add_transaction(ัั1)
        self.ะฑะปะพะบัะตะนะฝ.add_transaction(ัั2)
        self.ะฑะปะพะบัะตะนะฝ.add_transaction(ัั3)
        
        print(f"โ ะกะพะทะดะฐะฝะพ ััะฐะฝะทะฐะบัะธะน: 3")
        print(f"๐ฐ ะะปะธัะฐ โ ะะพะฑ: 1000 ะะกะขะะ")
        print(f"๐ฐ ะะพะฑ โ ะะปะฐะดะธะผะธั: 500 ะะกะขะะ") 
        print(f"๐ฐ ะะปะฐะดะธะผะธั โ ะะปะธัะฐ: 250 ะะกะขะะ")
        print(f"๐ ะ ะพัะตัะตะดะธ: {len(self.ะฑะปะพะบัะตะนะฝ.pending_transactions)} ััะฐะฝะทะฐะบัะธะน")
        
        return [ัั1, ัั2, ัั3]
    
    def ัะพะทะดะฐัั_ะฑะปะพะบ_ะฟะพ_ะบะพัะผะพัั(self, ะฐัััะพ_ะดะฐะฝะฝัะต):
        """ะกะพะทะดะฐะตั ะฑะปะพะบ ะฝะฐ ะพัะฝะพะฒะต ะบะพัะผะธัะตัะบะธั ะดะฐะฝะฝัั"""
        print("\nโ๏ธ === ะกะะะะะะะ ะะะะะ ะะ ะะะกะะะงะะกะะะ ะะะะะซะ ===")
        
        # ะััะธัะปัะตะผ ะฐัััะพะฝะพะผะธัะตัะบะธะน ะบะพะฝัะตะฝััั
        ัะตั_ะบะพะฝัะตะฝัััะฐ = self.ะบะพะฝัะตะฝััั.calculate_astronomical_consensus(ะฐัััะพ_ะดะฐะฝะฝัะต)
        ะฐัััะพ_ะดะฐะฝะฝัะต["astronomical_hash"] = ัะตั_ะบะพะฝัะตะฝัััะฐ
        
        print(f"๐งฎ ะะพะฝัะตะฝััั-ัะตั: {ัะตั_ะบะพะฝัะตะฝัััะฐ[:16]}...")
        
        # ะัะพะฒะตััะตะผ ะฟัะฐะฒะพ ัะพะทะดะฐัั ะฑะปะพะบ
        ะผะพะถะตั_ัะพะทะดะฐัั = self.ะบะพะฝัะตะฝััั.can_create_block(ัะตั_ะบะพะฝัะตะฝัััะฐ, self.ะบะพะฝัะตะฝััั.node_id)
        print(f"๐ฏ ะัะฐะฒะพ ัะพะทะดะฐัั ะฑะปะพะบ: {'ะะ' if ะผะพะถะตั_ัะพะทะดะฐัั else 'ะะะข'}")
        
        if not ะผะพะถะตั_ัะพะทะดะฐัั:
            print("๐จ ะัะตะผ ะฟะพะดัะพะดััะธะน nonce (ะดะพะบะฐะทะฐัะตะปัััะฒะพ ัะฐะฑะพัั)...")
            nonce = self.ะบะพะฝัะตะฝััั.find_valid_nonce(ัะตั_ะบะพะฝัะตะฝัััะฐ, max_attempts=100000)
            if nonce:
                print(f"โ ะะฐะนะดะตะฝ nonce: {nonce}")
                ะผะพะถะตั_ัะพะทะดะฐัั = True
            else:
                print("โ Nonce ะฝะต ะฝะฐะนะดะตะฝ")
                return None
        
        if ะผะพะถะตั_ัะพะทะดะฐัั:
            ะฑะปะพะบ = self.ะฑะปะพะบัะตะนะฝ.create_block(ะฐัััะพ_ะดะฐะฝะฝัะต)
            print(f"โ ะะปะพะบ #{ะฑะปะพะบ.index} ััะฟะตัะฝะพ ัะพะทะดะฐะฝ!")
            print(f"๐ฆ ะฅะตั ะฑะปะพะบะฐ: {ะฑะปะพะบ.hash[:16]}...")
            print(f"๐ ะัััะพะฝะพะผะธัะตัะบะธะน ัะตั: {ะฑะปะพะบ.astronomical_hash[:16]}...")
            print(f"๐ณ ะขัะฐะฝะทะฐะบัะธะน ะฒ ะฑะปะพะบะต: {len(ะฑะปะพะบ.transactions)}")
            return ะฑะปะพะบ
        
        return None
    
    def ะฟะพะบะฐะทะฐัั_ะฑะฐะปะฐะฝัั(self):
        """ะะพะบะฐะทัะฒะฐะตั ะฑะฐะปะฐะฝัั ะฒัะตั ััะฐััะฝะธะบะพะฒ"""
        print("\n๐ฐ === ะะะะะะกะซ ะฃะงะะกะขะะะะะ ===")
        
        ััะฐััะฝะธะบะธ = ["ะะปะธัะฐ_ะัััะพะงะตะนะฝ", "ะะพะฑ_ะัััะพะงะตะนะฝ", "ะะปะฐะดะธะผะธั_ะัััะพะงะตะนะฝ"]
        
        for ััะฐััะฝะธะบ in ััะฐััะฝะธะบะธ:
            ะฑะฐะปะฐะฝั = self.ะฑะปะพะบัะตะนะฝ.get_balance(ััะฐััะฝะธะบ)
            if ะฑะฐะปะฐะฝั > 0:
                print(f"๐ {ััะฐััะฝะธะบ}: +{ะฑะฐะปะฐะฝั} ะะกะขะะ")
            elif ะฑะฐะปะฐะฝั < 0:
                print(f"๐ธ {ััะฐััะฝะธะบ}: {ะฑะฐะปะฐะฝั} ะะกะขะะ")
            else:
                print(f"โช {ััะฐััะฝะธะบ}: {ะฑะฐะปะฐะฝั} ะะกะขะะ")
    
    def ะฟัะพะฒะตัะธัั_ัะธััะตะผั(self):
        """ะัะพะฒะตััะตั ัะฐะฑะพัะพัะฟะพัะพะฑะฝะพััั ะฒัะตะน ัะธััะตะผั"""
        print("\n๐ === ะะะะะะะะ ะกะะกะขะะะซ ===")
        
        # ะัะพะฒะตััะตะผ ะฑะปะพะบัะตะนะฝ
        ะฒะฐะปะธะดะฝะพััั_ัะตะฟะธ = self.ะฑะปะพะบัะตะนะฝ.is_chain_valid()
        print(f"โ๏ธ ะะปะพะบัะตะนะฝ ะฒะฐะปะธะดะตะฝ: {'ะะ' if ะฒะฐะปะธะดะฝะพััั_ัะตะฟะธ else 'ะะะข'}")
        
        # ะะฝัะพัะผะฐัะธั ะพ ะฑะปะพะบัะตะนะฝะต
        ะธะฝัะพ = self.ะฑะปะพะบัะตะนะฝ.get_chain_info()
        print(f"๐ ะะปะธะฝะฐ ัะตะฟะธ: {ะธะฝัะพ['length']} ะฑะปะพะบะพะฒ")
        print(f"โณ ะขัะฐะฝะทะฐะบัะธะน ะฒ ะพะถะธะดะฐะฝะธะธ: {ะธะฝัะพ['pending_transactions']}")
        
        # ะะพัะปะตะดะฝะธะน ะฑะปะพะบ
        ะฟะพัะปะตะดะฝะธะน_ะฑะปะพะบ = self.ะฑะปะพะบัะตะนะฝ.get_latest_block()
        print(f"๐ ะะพัะปะตะดะฝะธะน ะฑะปะพะบ: #{ะฟะพัะปะตะดะฝะธะน_ะฑะปะพะบ.index}")
        
        ะธััะพัะฝะธะบะธ = ะฟะพัะปะตะดะฝะธะน_ะฑะปะพะบ.astronomical_data.get('sources', {})
        if ะธััะพัะฝะธะบะธ:
            print(f"๐ ะะพัะผะธัะตัะบะธะต ะธััะพัะฝะธะบะธ: {list(ะธััะพัะฝะธะบะธ.keys())}")
        
        return ะฒะฐะปะธะดะฝะพััั_ัะตะฟะธ
    
    def ะฟะพะปะฝะฐั_ะดะตะผะพะฝัััะฐัะธั(self):
        """ะะฐะฟััะบะฐะตั ะฟะพะปะฝัั ะดะตะผะพะฝัััะฐัะธั ะฝะฐ ััััะบะพะผ ัะทัะบะต"""
        print("=" * 70)
        print("๐ท๐บ ะะะะะะกะขะะะฆะะฏ ะกะะกะขะะะซ ะะกะขะะะงะะะ ๐ท๐บ")
        print("=" * 70)
        print("ะะปะพะบัะตะนะฝ ะฝะฐ ะพัะฝะพะฒะต ะฐัััะพะฝะพะผะธัะตัะบะธั ะดะฐะฝะฝัั")
        print("ะะฐะทัะฐะฑะพัะฐะฝะพ ะบะฐะบ ัะบัะฟะตัะธะผะตะฝั ะฝะตะทะฐะฒะธัะธะผะพะน ะฒะฐะปััั")
        print("=" * 70)
        
        try:
            # 1. ะะพะบะฐะทัะฒะฐะตะผ ะบะพัะผะธัะตัะบะธะต ะดะฐะฝะฝัะต
            ะฐัััะพ_ะดะฐะฝะฝัะต = self.ะฟะพะบะฐะทะฐัั_ะฐัััะพะฝะพะผะธัะตัะบะธะต_ะดะฐะฝะฝัะต()
            
            # 2. ะกะพะทะดะฐะตะผ ััะฐะฝะทะฐะบัะธะธ
            ััะฐะฝะทะฐะบัะธะธ = self.ัะพะทะดะฐัั_ััะฐะฝะทะฐะบัะธะธ()
            
            # 3. ะกะพะทะดะฐะตะผ ะฑะปะพะบ ะฝะฐ ะพัะฝะพะฒะต ะบะพัะผะพัะฐ
            ะฑะปะพะบ = self.ัะพะทะดะฐัั_ะฑะปะพะบ_ะฟะพ_ะบะพัะผะพัั(ะฐัััะพ_ะดะฐะฝะฝัะต)
            
            if ะฑะปะพะบ:
                # 4. ะะพะบะฐะทัะฒะฐะตะผ ะฑะฐะปะฐะฝัั
                self.ะฟะพะบะฐะทะฐัั_ะฑะฐะปะฐะฝัั()
                
                # 5. ะัะพะฒะตััะตะผ ัะธััะตะผั
                ัะธััะตะผะฐ_ัะฐะฑะพัะฐะตั = self.ะฟัะพะฒะตัะธัั_ัะธััะตะผั()
                
                if ัะธััะตะผะฐ_ัะฐะฑะพัะฐะตั:
                    print("\n๐ === ะฃะกะะะฅ! ะะกะฏ ะกะะกะขะะะ ะะะะะขะะะข! ===")
                    print("โจ ะัััะพะงะตะนะฝ ะณะพัะพะฒ ะบ ัะตะฐะปัะฝะพะผั ัะตััะธัะพะฒะฐะฝะธั!")
                    print("๐ ะญัะพ ะฟะตัะฒัะน ะฒ ะผะธัะต ะฑะปะพะบัะตะนะฝ ะฝะฐ ะบะพัะผะธัะตัะบะธั ะดะฐะฝะฝัั!")
                else:
                    print("\nโ === ะะจะะะะ ะ ะกะะกะขะะะ ===")
            else:
                print("\nโธ๏ธ === ะะ ะฃะะะะะกะฌ ะกะะะะะขะฌ ะะะะ ===")
            
            print("\n๐ฌ === ะขะะฅะะะงะะกะะะฏ ะะะคะะะะะฆะะฏ ===")
            print(f"๐ป ะะปะณะพัะธัะผ ะบะพะฝัะตะฝัััะฐ: Proof of Astronomy (PoA)")
            print(f"๐ ะััะพัะฝะธะบะธ ะดะฐะฝะฝัั: NASA, NOAA")
            print(f"โฑ๏ธ ะะฝัะตัะฒะฐะป ะฑะปะพะบะพะฒ: {self.ะบะพะฝัะตะฝััั.block_interval.total_seconds()/60} ะผะธะฝัั")
            print(f"๐ ะฃัะพะฒะตะฝั ัะปะพะถะฝะพััะธ: {self.ะบะพะฝัะตะฝััั.difficulty_target}")
            print(f"๐ ID ััะพะณะพ ัะทะปะฐ: {self.ะบะพะฝัะตะฝััั.node_id}")
            
            return True
            
        except Exception as ะพัะธะฑะบะฐ:
            print(f"\n๐ฅ ะะจะะะะ: {ะพัะธะฑะบะฐ}")
            return False

# ะะฐะฟััะบะฐะตะผ ััััะบัั ะดะตะผะพะฝัััะฐัะธั
if __name__ == "__main__":
    ะดะตะผะพ = ะัััะพะงะตะนะฝะะตะผะพ()
    ััะฟะตั = ะดะตะผะพ.ะฟะพะปะฝะฐั_ะดะตะผะพะฝัััะฐัะธั()
    
    if ััะฟะตั:
        print("\n๐ ะะะะะะะะะฏะะ! MVP ะัััะพะงะตะนะฝ ัะฐะฑะพัะฐะตั!")
        print("๐ ะะพัะพะฒะพ ะบ ะทะฐะณััะทะบะต ะฒ GitHub ะธ ะดะฐะปัะฝะตะนัะตะน ัะฐะทัะฐะฑะพัะบะต!")
    else:
        print("\n๐ง ะขัะตะฑัะตััั ะพัะปะฐะดะบะฐ")
